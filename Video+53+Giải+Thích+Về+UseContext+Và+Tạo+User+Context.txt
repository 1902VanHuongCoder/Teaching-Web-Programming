# âš›ï¸ useContext vÃ  User Context - HÆ°á»›ng dáº«n chi tiáº¿t

## 1. ğŸ¤” useContext lÃ  gÃ¬?

**useContext** lÃ  má»™t React Hook giÃºp chia sáº» dá»¯ liá»‡u giá»¯a cÃ¡c component mÃ  khÃ´ng cáº§n truyá»n props qua tá»«ng cáº¥p (trÃ¡nh "prop drilling").

<HamA name={} email={} />

### âŒ Váº¥n Ä‘á» trÆ°á»›c khi cÃ³ useContext:
```javascript
// Pháº£i truyá»n props qua nhiá»u cáº¥p
function App() {
  const [user, setUser] = useState(null);
  return <Header user={user} setUser={setUser} />;
}

function Header({ user, setUser }) {
  return <UserInfo user={user} setUser={setUser} />;
}

function UserInfo({ user, setUser }) {
  return <span>{user?.name}</span>;
}
```

### âœ… Giáº£i phÃ¡p vá»›i useContext:
```javascript
// Dá»¯ liá»‡u Ä‘Æ°á»£c chia sáº» toÃ n cá»¥c, khÃ´ng cáº§n truyá»n props
function App() {
  return (
    <UserProvider> 
      <Header />
    </UserProvider>
  );
}

function Header() {
  return <UserInfo />;
}

function UserInfo() {
  const { user } = useContext(UserContext);
  return <span>{user?.name}</span>;
}
```

## 2. âš™ï¸ CÃ¡ch hoáº¡t Ä‘á»™ng trong User Context

### ğŸ”§ BÆ°á»›c 1: Táº¡o Context
```javascript
const UserContext = createContext();
```
- ğŸ“¦ Táº¡o má»™t "kho chá»©a" dá»¯ liá»‡u cÃ³ thá»ƒ chia sáº».

### ğŸ¯ BÆ°á»›c 2: Provider - Cung cáº¥p dá»¯ liá»‡u
```javascript
export const UserProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  
  const value = {
    user,        // ThÃ´ng tin ngÆ°á»i dÃ¹ng
    setUser,     // HÃ m cáº­p nháº­t
  };

  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;
};
```
- **UserProvider** bá»c quanh cÃ¡c component con vÃ  cung cáº¥p dá»¯ liá»‡u cho chÃºng.

### ğŸ”Œ BÆ°á»›c 3: Sá»­ dá»¥ng Context
```javascript
const { user, setUser } = useContext(UserContext);
```

## 3. ğŸ’¡ VÃ­ dá»¥ sá»­ dá»¥ng thá»±c táº¿

### ğŸ“± BÆ°á»›c 1: Bá»c App báº±ng Provider
```javascript
// main.jsx hoáº·c App.jsx
import { UserProvider } from './contexts/user-context';

function App() {
  return (
    <UserProvider>
      <Router>
        <Header />
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/profile" element={<Profile />} />
          <Route path="/login" element={<Login />} />
        </Routes>
        <Footer />
      </Router>
    </UserProvider>
  );
}
```

### ğŸ¯ BÆ°á»›c 2: Sá»­ dá»¥ng trong Header
```javascript
// Header.jsx
import { useContext } from 'react';
import { UserContext } from '../contexts/user-context';

function Header() {
  const { user, setUser } = useContext(UserContext);
  
  const handleLogout = () => {
    setUser(null);
    localStorage.removeItem('user');
  };
  
  return (
    <header>
      {user ? (
        <div>
          <span>Xin chÃ o, {user.tenNguoiDung}!</span>
          <button onClick={handleLogout}>ÄÄƒng xuáº¥t</button>
        </div>
      ) : (
        <a href="/login">ÄÄƒng nháº­p</a>
      )}
    </header>
  );
}
```

### ğŸ” BÆ°á»›c 3: Sá»­ dá»¥ng trong trang Login
```javascript
// Login.jsx
import { useContext } from 'react';
import { UserContext } from '../contexts/user-context';

function Login() {
  const { setUser } = useContext(UserContext);
  
  const handleLogin = async (formData) => {
    try {
      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      
      if (response.ok) {
        const userData = await response.json();
        setUser(userData); // Cáº­p nháº­t user toÃ n cá»¥c
        localStorage.setItem('user', JSON.stringify(userData));
      }
    } catch (error) {
      console.error('Lá»—i Ä‘Äƒng nháº­p:', error);
    }
  };
  
  return (
    <form onSubmit={handleLogin}>
      {/* Form Ä‘Äƒng nháº­p */}
    </form>
  );
}
```

### ğŸ‘¤ BÆ°á»›c 4: Sá»­ dá»¥ng trong Profile
```javascript
// Profile.jsx
import { useContext } from 'react';
import { UserContext } from '../contexts/user-context';

function Profile() {
  const { user, setUser } = useContext(UserContext);
  
  const updateProfile = async (newData) => {
    try {
      const response = await fetch(`/api/users/${user.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newData)
      });
      
      if (response.ok) {
        const updatedUser = await response.json();
        setUser(updatedUser); // Cáº­p nháº­t user toÃ n cá»¥c
        localStorage.setItem('user', JSON.stringify(updatedUser));
      }
    } catch (error) {
      console.error('Lá»—i cáº­p nháº­t:', error);
    }
  };
  
  return (
    <div>
      <h1>Há»“ sÆ¡ cá»§a {user?.tenNguoiDung}</h1>
      <p>Email: {user?.email}</p>
      <p>Sá»‘ Ä‘iá»‡n thoáº¡i: {user?.soDienThoai}</p>
      {/* Form chá»‰nh sá»­a profile */}
    </div>
  );
}
```

## 4. ğŸŒŸ Lá»£i Ã­ch cá»§a useContext

### âœ… Æ¯u Ä‘iá»ƒm:
- **TrÃ¡nh prop drilling**: KhÃ´ng cáº§n truyá»n props qua nhiá»u cáº¥p
- **Chia sáº» dá»¯ liá»‡u toÃ n cá»¥c**: Má»i component Ä‘á»u cÃ³ thá»ƒ truy cáº­p
- **Dá»… quáº£n lÃ½ state**: Táº­p trung quáº£n lÃ½ dá»¯ liá»‡u á»Ÿ má»™t nÆ¡i
- **Tá»± Ä‘á»™ng re-render**: Component tá»± Ä‘á»™ng cáº­p nháº­t khi dá»¯ liá»‡u thay Ä‘á»•i

### âš ï¸ LÆ°u Ã½:
- **Performance**: Khi context thay Ä‘á»•i, táº¥t cáº£ component sá»­ dá»¥ng nÃ³ sáº½ re-render
- **Over-usage**: KhÃ´ng nÃªn dÃ¹ng cho má»i dá»¯ liá»‡u, chá»‰ dÃ¹ng cho dá»¯ liá»‡u thá»±c sá»± cáº§n chia sáº»
- **Complexity**: CÃ³ thá»ƒ lÃ m code phá»©c táº¡p náº¿u abuse

## 5. ğŸš€ Best Practices

### ğŸ¯ 1. TÃ¡ch cÃ¡c Context riÃªng biá»‡t
```javascript
// TÃ¡ch riÃªng thay vÃ¬ gá»™p chung
<UserProvider>
  <ThemeProvider>
    <CartProvider>
      <App />
    </CartProvider>
  </ThemeProvider>
</UserProvider>
```

### ğŸª 2. Táº¡o custom hook
```javascript
// hooks/useUser.js
import { useContext } from 'react';
import { UserContext } from '../contexts/user-context';

export const useUser = () => {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser pháº£i Ä‘Æ°á»£c sá»­ dá»¥ng trong UserProvider');
  }
  return context;
};

// Sá»­ dá»¥ng
const { user, setUser } = useUser(); // Thay vÃ¬ useContext(UserContext)
```

### âš¡ 3. Tá»‘i Æ°u performance
```javascript
// TÃ¡ch dá»¯ liá»‡u Ã­t thay Ä‘á»•i vÃ  thÆ°á»ng xuyÃªn thay Ä‘á»•i
const UserProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [preferences, setPreferences] = useState({});
  
  // TÃ¡ch thÃ nh 2 context riÃªng Ä‘á»ƒ trÃ¡nh re-render khÃ´ng cáº§n thiáº¿t
  const userValue = useMemo(() => ({ user, setUser }), [user]);
  const preferencesValue = useMemo(() => ({ preferences, setPreferences }), [preferences]);
  
  return (
    <UserContext.Provider value={userValue}>
      <PreferencesContext.Provider value={preferencesValue}>
        {children}
      </PreferencesContext.Provider>
    </UserContext.Provider>
  );
};
```

## 6. ğŸ“ TÃ³m táº¯t

- ğŸ“¦ **Context**: Kho chá»©a dá»¯ liá»‡u chung
- ğŸ¯ **Provider**: Cung cáº¥p dá»¯ liá»‡u cho component con  
- ğŸ”Œ **useContext**: Hook Ä‘á»ƒ truy cáº­p dá»¯ liá»‡u tá»« Context
- ğŸŒŸ **Lá»£i Ã­ch chÃ­nh**: TrÃ¡nh prop drilling, chia sáº» dá»¯ liá»‡u toÃ n cá»¥c
- âœ… **Sá»­ dá»¥ng khi**: Cáº§n chia sáº» dá»¯ liá»‡u giá»¯a nhiá»u component khÃ´ng liÃªn quan trá»±c tiáº¿p
- âŒ **KhÃ´ng sá»­ dá»¥ng khi**: Dá»¯ liá»‡u chá»‰ cáº§n trong vÃ i component gáº§n nhau
